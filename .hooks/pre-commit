#!/bin/sh

echo "ğŸ” Checking for staged PHP files..."
files=$(git diff --cached --name-only --diff-filter=AMCR | grep "\.php$")

if [ -z "$files" ]; then
    echo "âœ… No PHP files staged. Skipping Laravel Pint, Insights, and Tests."
    exit 0
fi

echo "âœ¨ Running Laravel Pint..."
./vendor/bin/pint $files && git add $files || { echo "âŒ Pint failed! Fix errors before committing."; exit 1; }

echo "ğŸ“Š Running Laravel Insights..."
php artisan insights --no-interaction --min-quality=100 --min-complexity=85 --min-architecture=100 --min-style=100

echo "ğŸ§ª Running Laravel Tests..."
php artisan test || { echo "âŒ Tests failed! Fix before committing."; exit 1; }

echo "âœ… All checks passed! Commit successful."
exit 0

